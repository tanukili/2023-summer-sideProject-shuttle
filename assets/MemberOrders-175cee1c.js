import{m as x,a as v,M as L,_ as P,p as B,r as _,o as l,c,b as e,t as d,f as g,g as M,n as y,k as p,F as f,e as C,i as F,w as V,E as $,D as q,l as j,u as E,d as I}from"./index-77334642.js";import{u as N}from"./useProductsStore-276b816b.js";import{u as R}from"./utilitiesStore-f3e398c9.js";import{m as T}from"./memberStore-491edb31.js";import{M as z}from"./MemberNavs-9b2e3bf3.js";import{S as G,a as J,P as W}from"./pagination-1b20c86f.js";import{P as H}from"./ProductModal-82bf9fc3.js";import{B as K}from"./BackToTop-1bd7753e.js";const Q={components:{Swiper:G,SwiperSlide:J},props:["clickedCourse"],data(){return{url:"https://sideproject-shuttle.onrender.com",modal:null,comment:{orderId:"",productId:"",imgUrls:[],agreeToShare:!1,satisfaction:{content:null,process:null,quality:null,recommend:null},describe:""},imgFile:null,swiper:null,modules:[W],satisfactionOption:[{label:"課程內容",id:"content"},{label:"流程設計",id:"process"},{label:"教學品質",id:"quality"},{label:"值得推薦",id:"recommend"}]}},computed:{...x(T,["userComments"]),...x(B,["alertstyles"])},methods:{...v(T,["postComment"]),...v(B,["baseContent"]),onSwiper(s){this.swiper=s},imgToFormData(s){const i=s.target.files[0];this.imgFile=i,this.comment.imgUrls.push(URL.createObjectURL(i))},userAddImg(){const s=new FormData,i=new Date().getTime();s.append("image",this.imgFile),s.append("type","image"),s.append("title",`心得圖片-${i}`),s.append("description","Shuttle side project 儲存用戶端上傳圖片"),s.append("album","TtjzDJS"),this.axios.post("https://api.imgur.com/3/image",s,{headers:{Authorization:"Bearer a613a90a6ef64bac02f6ab85e98c34e94587a48d","Content-Type":"multipart/form-data"}}).then(n=>{this.alertstyles.toast.fire(this.baseContent("新增成功"));const{link:u}=n.data.data,o=this.comment.imgUrls.length;this.comment.imgUrls[o-1]=u,document.querySelector("#addImgInput").value=""}).catch(n=>{this.alertstyles.toast_danger.fire(this.baseContent(`新增失敗 問題${n.response.status}`))})}},watch:{clickedCourse(s){s.isCommented?this.comment={...this.userComments.find(i=>i.orderId===s.id)}:(this.comment.orderId=s.id,this.comment.productId=s.product_id)}},mounted(){this.modal=new L(document.getElementById("commentModal"));const s="_element";this.modal[s].addEventListener("hidden.bs.modal",()=>{const{comment:i}=this.$options.data();this.clickedCourse.isCommented?this.comment={...i}:(this.$refs.commentForm.resetForm(),this.comment.imgUrls=[...i.imgUrls],this.comment.agreeToShare=i.agreeToShare),document.querySelector("#addImgInput").value=""})}},X={class:"modal fade",id:"commentModal",tabindex:"-1"},Y={class:"modal-dialog modal-dialog-scrollable modal-lg"},Z={class:"modal-content"},ee={class:"modal-header bg-primary border-dashed border-white border-bottom-0 pb-3"},te={class:"modal-title fs-6 text-white"},se={class:"modal-body p-5"},oe={class:"row gy-7"},ne={class:"col-lg-6 d-flex flex-column justify-content-between"},ie={class:"d-flex align-items-end mb-2"},le={key:0,class:"ms-3 text-danger"},ce=e("p",{class:"fs-8 mb-3"},"1 為「非常不滿意」，5 為「非常滿意」。",-1),re={class:"table text-center mb-0"},de={class:"border-gray-200"},ae=e("th",{scope:"col",width:"86",class:"fw-normal"},"選項",-1),me={scope:"col"},ue=e("th",{scope:"col"},"2",-1),he=e("th",{scope:"col"},"3",-1),_e=e("th",{scope:"col"},"4",-1),pe=e("th",{scope:"col"},"5",-1),be={scope:"row"},ge=["for"],fe={key:1},ye={class:"col-lg-6"},Ce={class:"mb-2"},ke=e("label",{class:"fs-8 mb-3",for:"feedback"},"自由填寫課後心得或建議",-1),we={key:1,class:"px-4 py-3 border border-gray-200 rounded-1",style:{height:"180px"}},xe={class:"col-lg-10"},ve={class:"mb-0 mb-2"},Oe={key:0,class:"d-flex aling-items-center ms-2 mb-3"},Se=e("label",{class:"fs-8",for:"agreeShare"}," 我同意提供分享的照片，作為 Shuttle 宣傳之用。 ",-1),Me={class:"input-group fs-7 ms-2"},Ue=["disabled"],De={class:"col-12 mt-3"},Ie=["src","alt"],Te={key:1,class:"bg-dark bg-opacity-25 rounded-1 d-flex justify-content-center"},Fe=e("span",{class:"py-5"},"沒有上傳任何圖片",-1),Be=[Fe],Ve={type:"submit",class:"d-none",ref:"submitBtn"},je={class:"modal-footer bg-white border-0 pt-3 text-center"},Ne=e("button",{type:"button",class:"btn btn-outline-secondary fs-7 py-2","data-bs-dismiss":"modal"}," 關閉 ",-1);function Pe(s,i,n,u,o,r){var U,D;const b=_("VField"),m=_("swiper-slide"),O=_("swiper"),S=_("VForm");return l(),c("div",X,[e("div",Y,[e("div",Z,[e("div",ee,[e("h4",te,"課程名稱："+d((D=(U=n.clickedCourse)==null?void 0:U.product)==null?void 0:D.title),1)]),e("div",se,[g(S,{novalidate:"",onSubmit:i[3]||(i[3]=k=>s.postComment({...o.comment},o.modal)),class:"contanier overflow-hidden",ref:"commentForm"},{default:M(({errors:k})=>[e("div",oe,[e("div",ne,[e("div",ie,[e("h5",{class:y(["mb-0",{required:!n.clickedCourse.isCommented}])},d(n.clickedCourse.isCommented?"您的評價":"滿意度調查"),3),Object.keys(k).length?(l(),c("span",le," 請確認是否填寫完整 ")):p("",!0)]),ce,e("table",re,[e("thead",null,[e("tr",de,[ae,e("th",me,d(n.clickedCourse.isCommented?"滿意度":"1"),1),n.clickedCourse.isCommented?p("",!0):(l(),c(f,{key:0},[ue,he,_e,pe],64))])]),e("tbody",null,[(l(!0),c(f,null,C(o.satisfactionOption,t=>(l(),c("tr",{key:t.id,class:"border-light"},[e("th",be,[e("label",{class:"form-check-label",for:t.id},d(t.label),9,ge)]),n.clickedCourse.isCommented?(l(),c("td",fe,[(l(),c(f,null,C(5,a=>e("i",{class:y(["bi mx-1 text-warning",[a<=o.comment.satisfaction[t.id]?"bi-star-fill":"bi-star"]]),key:a},null,2)),64))])):(l(),c(f,{key:0},C(5,a=>e("td",{key:a},[g(b,{rules:"required",name:t.id,type:"radio",value:a,id:a===5?t.id:"",class:"form-check-input",modelValue:o.comment.satisfaction[t.id],"onUpdate:modelValue":w=>o.comment.satisfaction[t.id]=w},null,8,["name","value","id","modelValue","onUpdate:modelValue"])])),64))]))),128))])])]),e("div",ye,[e("h5",Ce,d(n.clickedCourse.isCommented?"您的意見":"意見反饋"),1),ke,n.clickedCourse.isCommented?(l(),c("p",we,d(o.comment.describe?o.comment.describe:"無相關評論"),1)):(l(),F(b,{key:0,as:"textarea",class:"form-control fs-7 bg-white",name:"feedback",id:"feedback",style:{height:"180px"},modelValue:o.comment.describe,"onUpdate:modelValue":i[0]||(i[0]=t=>o.comment.describe=t)},null,8,["modelValue"]))]),e("div",xe,[e("h5",ve,d(n.clickedCourse.isCommented?"照片集":"分享照片"),1),n.clickedCourse.isCommented?p("",!0):(l(),c("div",Oe,[V(e("input",{class:"form-check-input fs-8 me-1",type:"checkbox",id:"agreeShare","onUpdate:modelValue":i[1]||(i[1]=t=>o.comment.agreeToShare=t)},null,512),[[$,o.comment.agreeToShare]]),Se])),V(e("div",Me,[g(b,{name:"imgUrl",type:"file",id:"addImgInput",class:"form-control fs-7 bg-white py-2",accept:"image/*",onChange:r.imgToFormData},null,8,["onChange"]),e("button",{class:"btn btn-primary fs-7 fw-medium py-2 px-4 rounded-end-1 shadow-none",type:"button",onClick:i[2]||(i[2]=(...t)=>r.userAddImg&&r.userAddImg(...t)),disabled:!o.comment.imgUrls.some(t=>t.startsWith("blob"))}," 上傳檔案 ",8,Ue)],512),[[q,!n.clickedCourse.isCommented]])]),e("div",De,[o.comment.imgUrls.length?(l(),F(O,{key:0,class:y(["comment-swiper",{"pb-7":o.comment.imgUrls.length>2,"pb-lg-0":o.comment.imgUrls.length>2&&o.comment.imgUrls.length<=4}]),spaceBetween:12,noSwiping:!0,pagination:!0,modules:o.modules,onSwiper:r.onSwiper,slidesPerView:2,breakpoints:{992:{slidesPerView:4}}},{default:M(()=>[o.comment.imgUrls.length?(l(!0),c(f,{key:0},C(o.comment.imgUrls,(t,a)=>(l(),F(m,{key:a},{default:M(()=>[e("img",{src:t,alt:`課程照片${a+1}`,style:{height:"105px"},class:"shadow-sm bg-white",referrerpolicy:"no-referrer",id:"123"},null,8,Ie)]),_:2},1024))),128)):p("",!0)]),_:1},8,["class","modules","onSwiper"])):(l(),c("div",Te,Be))])]),e("button",Ve,null,512)]),_:1},512)]),e("div",je,[Ne,n.clickedCourse.isCommented?p("",!0):(l(),c("button",{key:0,onClick:i[4]||(i[4]=k=>this.$refs.submitBtn.click()),type:"button",class:"btn btn-primary fs-7 py-2 ms-2"}," 送出 "))])])])])}const Ae=P(Q,[["render",Pe]]);const Le={components:{MemberNavs:z,CommentModal:Ae,ProductModal:H,BackToTop:K},data(){return{isOrdersMode:!0,clickedCourse:{},orders:null,courses:null,orderOption:["全部訂單","未付款訂單"],courseOption:["所有課程","未開課","授課中","已完課"],nowOption:"全部訂單"}},methods:{...v(j,["getFontData"]),...v(T,["getUserCommits"]),...v(N,["getProduct"]),...v(R,["unixToStr"]),getOption(s){this.nowOption=s},switchMode(){this.isOrdersMode=!this.isOrdersMode,this.isOrdersMode?this.nowOption="全部訂單":this.nowOption="所有課程"},findRecentCourse(s){const n=s.flat(),[u]=n;let o=0,r=null;const b=["開課日","今日上課","下節課程","完課"];if(u<=1720098002&&n[n.length-1]>=1720098002){const m=n.findIndex((O,S)=>O<=1720098002&&n[S+1]>=1720098002);o=m%2?2:1,r=m%2?n[m+1]:n[m]}return n.every(m=>m<1720098002)&&(o=3,r=n[n.length-1]),n.every(m=>m>1720098002)&&(r=u),{stateCode:o,caption:b[o],date:this.unixToStr(r,!1)}},fixSubtotal(s){const{promotion:i}=s.product.state,n=Object.keys(this.numActivities)[0],{percentOff:u}=this.numActivities[n];return i===n?s.final_total*u:s.final_total},checkIsCommented(s,i){return s.some(n=>n.orderId===i.id)}},computed:{...x(N,["singleProduct"]),...x(j,["remoteData"]),...x(T,["userComments"]),...x(E,["numActivities"]),navsOption(){return this.isOrdersMode?this.orderOption:this.courseOption},filteredList(){switch(this.nowOption){case this.orderOption[1]:return this.orders.filter(s=>!s.is_paid);case this.courseOption[0]:return this.courses;case this.courseOption[1]:return this.courses.filter(s=>s.recentCourse.stateCode===0);case this.courseOption[2]:return this.courses.filter(s=>s.recentCourse.stateCode>1&&s.recentCourse.stateCode<3);case this.courseOption[3]:return this.courses.filter(s=>s.recentCourse.stateCode===3);default:return this.orders}}},watch:{remoteData(s){this.orders=[...s].map(i=>{const n={...i};return Object.values(i.products).forEach(o=>{const{classTime:r}=o.product.info;n.products[o.id].recentCourse=this.findRecentCourse(r),n.products[o.id].isCommented=this.checkIsCommented(this.userComments,o)}),n}),this.courses=s.map(i=>Object.values(i.products)).flat()},userComments(s){var i;(i=this.orders)!=null&&i.length&&this.orders.forEach((n,u)=>{Object.values(n.products).forEach(r=>{this.orders[u].products[r.id].isCommented=s.some(b=>b.productId===r.product_id)})})}},mounted(){this.getFontData("orders"),this.getUserCommits()}},$e={class:"form-check form-switch mt-2 mb-3 ms-3"},qe={class:"form-check-label",for:"displaySwitch"},Ee={class:"bg-white py-2 px-5"},Re={key:0,class:"d-flex flex-column align-items-center py-5 lh-1"},ze=e("i",{class:"bi bi-journal-x text-gray-200 p-4 rounded-circle my-4",style:{"font-size":"92px",border:"6px solid var(--bs-gray-100)"}},null,-1),Ge=e("h3",null,"目前沒有任何訂單",-1),Je=e("span",{class:"icon-e icon-east"},null,-1),We={key:1,class:"list-unstyled"},He={class:"fs-7 mb-0 p-3 bg-light"},Ke={class:"table table-white text-center align-middle mb-0"},Qe=e("thead",{class:"d-none"},[e("tr",null,[e("th",{scope:"col"},"預覽圖片"),e("th",{scope:"col"},"課程名稱"),e("th",{scope:"col"},"報名人數"),e("th",{scope:"col"},"小計"),e("th",{scope:"col"})])],-1),Xe={width:"180"},Ye=["src","alt"],Ze={class:"fs-7 mb-0 text-start"},et={class:"text-end"},tt={width:"160"},st=["onClick"],ot=["onClick"],nt={colspan:"2",class:"text-start"},it=e("span",{class:"icon-e icon-east"},null,-1),lt={colspan:"3",class:"text-end"},ct={key:0,class:"badge bg-danger bg-opacity-25 text-danger rounded-1 fs-9 fw-bold me-1"},rt={key:2,class:"last-tr-borderless table my-4 table-white text-center align-middle"},dt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"近期開課"),e("th",{scope:"col"},"預覽圖片"),e("th",{scope:"col"},"課程名稱"),e("th",{scope:"col"},"人數"),e("th",{scope:"col"},"小計"),e("th",{scope:"col"})])],-1),at={class:"d-flex flex-column align-items-center fs-7"},mt={key:0,class:"fs-6"},ut={width:"120"},ht=["src","alt"],_t={class:"fs-7 mb-0"},pt={class:"text-end"},bt={width:"160"},gt=["onClick"],ft=["onClick"];function yt(s,i,n,u,o,r){var k;const b=_("MemberNavs"),m=_("RouterLink"),O=_("router-link"),S=_("ProductModal"),U=_("CommentModal"),D=_("BackToTop");return l(),c(f,null,[e("div",$e,[e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"displaySwitch",onClick:i[0]||(i[0]=t=>r.switchMode())}),e("label",qe,d(`切換成「${o.isOrdersMode?"個別課程":"訂單編號"}」模式`),1)]),g(b,{options:r.navsOption,"now-option":o.nowOption,onGetOption:r.getOption},null,8,["options","now-option","onGetOption"]),e("div",Ee,[(k=o.orders)!=null&&k.length?p("",!0):(l(),c("div",Re,[ze,Ge,g(m,{to:"/products",class:"btn btn-primary-light mt-3",style:{width:"280px"}},{default:M(()=>[I(" 選購課程 "),Je]),_:1})])),o.isOrdersMode?(l(),c("ul",We,[(l(!0),c(f,null,C(r.filteredList,t=>{var a,w;return l(),c("li",{class:"py-4 border-dashed-b border-gray-100",key:t.id},[e("h2",He,[I(" 訂單編號："+d(t.id)+" ",1),e("span",{class:y(["badge text-white ms-2 rounded-1",[t.is_paid?"bg-success":"bg-danger"]])},d(t.is_paid?"付款完成":"未付款"),3)]),e("table",Ke,[Qe,e("tbody",null,[(l(!0),c(f,null,C(t.products,h=>(l(),c("tr",{key:h.id},[e("td",Xe,[e("img",{src:h.product.imageUrl,alt:h.product.title,style:{height:"100px"}},null,8,Ye)]),e("td",null,[e("h3",Ze,d(h.product.title),1)]),e("td",null,d(h.qty)+" 位",1),e("td",et,"NT$ "+d(r.fixSubtotal(h)),1),e("td",tt,[e("button",{type:"button",class:"btn btn-outline-primary p-2 mx-2 w-75 fs-8 shadow-none","data-bs-toggle":"modal","data-bs-target":"#productInfo",onClick:A=>o.clickedCourse={...h}}," 課程資訊 ",8,st),h.recentCourse.stateCode===3?(l(),c("button",{key:0,type:"button",class:y(["btn p-2 mx-2 w-75 fs-8 shadow-none mt-2",[h.isCommented?"btn-primary-light":"btn-primary"]]),"data-bs-toggle":"modal","data-bs-target":"#commentModal",onClick:A=>o.clickedCourse={...h}},d(h.isCommented?"查看心得":"填寫心得"),11,ot)):p("",!0)])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",nt,[g(O,{class:"btn btn-primary-light py-2 fs-8 shadow-none",to:`/member/order/${t.id}`},{default:M(()=>[I(" 前往訂單明細 "),it]),_:2},1032,["to"])]),e("td",lt,[t.user.cartOverview.couponDiscount||t.user.cartOverview.fullDiscount?(l(),c("span",ct," 已扣除額外折扣：- "+d(t.user.cartOverview.couponDiscount+t.user.cartOverview.fullDiscount),1)):p("",!0),I(" 訂單總金額：NT$ "+d((w=(a=t==null?void 0:t.user)==null?void 0:a.cartOverview)==null?void 0:w.finalBill),1)])])])])])}),128))])):(l(),c("table",rt,[dt,e("tbody",null,[(l(!0),c(f,null,C(r.filteredList,(t,a)=>(l(),c("tr",{key:a},[e("td",null,[e("small",at,[e("span",{class:y(["badge rounded-1 mb-2",{"bg-success text-white":t.recentCourse.stateCode===0,"bg-primary text-white":t.recentCourse.stateCode===1,"bg-warning":t.recentCourse.stateCode===2,"bg-primary-light":t.recentCourse.stateCode===3}]),style:{"letter-spacing":"1.2px"}},d(t.recentCourse.caption),3),t.recentCourse.stateCode!==3?(l(),c("span",mt,d(t.recentCourse.date),1)):p("",!0)])]),e("td",ut,[e("img",{src:t.product.imageUrl,alt:t.product.title,style:{height:"100px"}},null,8,ht)]),e("td",null,[e("h2",_t,d(t.product.title),1)]),e("td",null,d(t.qty)+" 位",1),e("td",pt,"NT$ "+d(r.fixSubtotal(t)),1),e("td",bt,[e("button",{type:"button",class:"btn btn-outline-primary p-2 mx-2 w-75 fs-8 shadow-none","data-bs-toggle":"modal","data-bs-target":"#productInfo",onClick:w=>o.clickedCourse={...t}}," 課程資訊 ",8,gt),t.recentCourse.stateCode===3?(l(),c("button",{key:0,type:"button",class:y(["btn p-2 mx-2 w-75 fs-8 shadow-none mt-2",[t.isCommented?"btn-primary-light":"btn-primary"]]),"data-bs-toggle":"modal","data-bs-target":"#commentModal",onClick:w=>o.clickedCourse={...t}},d(t.isCommented?"查看心得":"填寫心得"),11,ft)):p("",!0)])]))),128))])]))]),g(S,{"clicked-course":o.clickedCourse},null,8,["clicked-course"]),g(U,{"clicked-course":o.clickedCourse},null,8,["clicked-course"]),g(D)],64)}const Ut=P(Le,[["render",yt]]);export{Ut as default};
