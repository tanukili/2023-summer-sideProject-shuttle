import{m as b,b as p,_ as I,p as x,l as C,o,c as l,a as t,d,t as i,F as g,k as u,f as A,n as y,r as w,g as m,h as v,w as B,u as O,e as j,v as N}from"./index-686eedae.js";import{u as V}from"./useCartsStore-3a1c0605.js";import{u as D}from"./useCouponStore-e10688e8.js";import{B as T}from"./BackgroundBanner-ce8413c2.js";import{u as L}from"./utilitiesStore-1f9ae4ab.js";const F={props:["sumSubtotals"],data(){return{coupons:[],clickedCoupon:{},total:0}},computed:{...b(x,["alertstyles"]),...b(C,["jsonData"]),...b(D,["couponId"]),availableCoupons(){return this.coupons.filter(e=>e.isAvailable)}},methods:{...p(x,["baseContent"]),...p(C,["getJsonData"]),...p(L,["unixToStr"]),...p(D,["toggleCoupon","getCookieCoupon"]),updateAvailable(){this.coupons.forEach((e,c)=>{const _=e.quota<=this.total;this.coupons[c].isAvailable=_})}},watch:{jsonData(e){this.coupons=[...e],this.updateAvailable(),this.clickedCoupon={...this.coupons.find(c=>c.id===this.couponId)}},sumSubtotals(e){this.total=e;const{quota:c}=this.clickedCoupon;e<c&&(this.alertstyles.alert.fire({...this.baseContent("優惠券移除",2),text:"目前金額未達該券使用限制"}),this.clickedCoupon={},this.toggleCoupon()),this.updateAvailable()}},mounted(){const e=Math.floor(new Date().getTime()/1e3);this.getJsonData("coupons",`?is_used=false&exp_gte=${e}`),this.getCookieCoupon(),this.total=this.sumSubtotals}},z={class:"fs-8 text-gray-600 mb-2"},P={type:"button",class:"btn btn-primary-light fs-7","data-bs-toggle":"modal","data-bs-target":"#couponModal"},U={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},E={class:"modal-dialog modal-dialog-scrollable text-start"},J={class:"modal-content"},R=t("div",{class:"modal-header bg-primary border-dashed border-white border-bottom-0 pb-3"},[t("h3",{class:"modal-title fs-6 text-white",id:"couponModalLabel"},"優惠券一覽"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},[t("i",{class:"bi bi-x-lg text-white"})])],-1),G={class:"modal-body px-3 py-7 p-sm-5"},H={key:0,class:"d-flex flex-column align-items-center lh-1"},K=t("i",{class:"bi bi-exclamation-lg text-gray-200 p-4 rounded-circle mb-3",style:{"font-size":"80px",border:"6px solid var(--bs-gray-100)"}},null,-1),Q=t("p",{class:"text-center fs-6 fw-semibold"},"沒有可使用的優惠券",-1),W=[K,Q],X={key:1},Y=t("p",null,"單筆訂單只能使用一張優惠券。",-1),Z={class:"form-check d-flex align-items-center"},tt=["id","onClick","checked","disabled"],et=["for"],st={key:0,class:"bi bi-check-circle-fill ms-1 text-success"},ot={class:"ms-auto"},lt={class:"mt-2"},it={key:0,class:"text-danger"};function at(e,c,_,k,r,a){return o(),l(g,null,[t("p",z,[d(" 您有 "+i(a.availableCoupons.length)+" 張優惠券可以使用 ",1),r.coupons.length-a.availableCoupons.length?(o(),l(g,{key:0},[d(" （ 另有 "+i(r.coupons.length-a.availableCoupons.length)+" 張未達使用限制 ） ",1)],64)):u("",!0),d(" 。 ")]),t("button",P,i(e.couponId&&r.clickedCoupon.title?`已套用「${r.clickedCoupon.title}」`:"選擇優惠券"),1),t("div",U,[t("div",E,[t("div",J,[R,t("div",G,[r.coupons.length?(o(),l("form",X,[Y,(o(!0),l(g,null,A(r.coupons,n=>(o(),l("div",{key:n.id,class:y(["border-dashed border-secondary rounded-1 p-4 fs-8 my-2",[n.isAvailable?"bg-white":"bg-gray-100 bg-opacity-50 text-gray-200"]])},[t("div",Z,[t("input",{class:"form-check-input me-2",type:"radio",name:"coupon",id:n.id,onClick:f=>(e.toggleCoupon(n),this.clickedCoupon={...n}),checked:e.couponId===n.id,disabled:!n.isAvailable},null,8,tt),t("label",{class:"form-check-label fs-6 fw-bold",for:n.id},i(n.title),9,et),e.couponId===n.id?(o(),l("i",st)):u("",!0),t("span",ot,"期限："+i(e.unixToStr(n.exp)),1)]),t("p",lt,[d(i(n.description)+" ",1),n.quota>r.total?(o(),l("i",it," 還差 "+i(n.quota-r.total)+" 元 ",1)):u("",!0)])],2))),128))])):(o(),l("div",H,W))])])])])],64)}const nt=I(F,[["render",at]]);const ct={components:{BackgroundBanner:T,CouponModal:nt},data(){return{bannerImg:"banner/banner-carts.jpg",couponCode:"",cart:[]}},computed:{...b(x,["alertstyles"]),...b(C,["cartData"]),...b(O,["allActive","unlimitedActivities","numActivities"]),...b(D,["couponDiscount"]),activities(){return{...this.numActivities,...this.unlimitedActivities}},cartOverview(){const{requiredPrice:e,percentOff:c}=this.allActive;return this.countCart(this.couponDiscount,e,c)}},methods:{...p(x,["baseContent","btns"]),...p(C,["getFontData"]),...p(O,["getActivities"]),...p(V,["putCart","deleteAllCart","deleteCart","countCart"]),activeAlert(){const{title:e,description:c,requiredPrice:_,percentOff:k}=this.allActive,r=_-this.cartOverview.sumSubtotals%_;this.alertstyles.alert_btns.fire({...this.baseContent(e,3,"修改訂單"),...this.btns("繼續結帳",!1),html:`<p>${c}</p><i class="fs-7">還差 <span class="text-danger">${r}</span> 元，就能再折抵 ${k} 元。</i>`}).then(a=>{a.isDenied&&this.$router.push("/order")})}},watch:{cartData(e){this.cart=[...e]}},mounted(){this.getActivities(),this.getFontData("cart")}},dt={class:"bg-white"},rt={class:"block-spacing-sm container"},ut={"aria-label":"breadcrumb",class:"mb-3"},pt={class:"breadcrumb"},ht={class:"breadcrumb-item"},mt={class:"breadcrumb-item"},bt=t("li",{class:"breadcrumb-item active","aria-current":"page"},"購物車",-1),_t={key:0,class:"d-flex flex-column align-items-center"},ft=t("span",{class:"material-symbols-outlined text-gray-200 p-4 rounded-circle my-4",style:{"font-size":"96px",border:"6px solid var(--bs-gray-100)"}}," production_quantity_limits ",-1),gt=t("h2",null,"目前購物車沒有課程",-1),vt=t("span",{class:"icon-e icon-east"},null,-1),yt={key:1},xt=t("div",{class:"w-100 w-md-75 d-flex flex-column mx-auto mt-5 mb-7 mb-lg-5"},[t("ol",{class:"d-flex justify-content-around ps-0 fs-7 fs-md-6 fw-bold"},[t("li",null,"訂單確認"),t("li",null,"填寫資料"),t("li",null,"訂單完成")]),t("div",{class:"progress border-dashed border-secondary"},[t("div",{class:"progress-bar",role:"progressbar",style:{width:"33.33%"},"aria-valuenow":"33.33","aria-valuemin":"0","aria-valuemax":"100"})])],-1),Ct=t("h2",{class:"title fs-4 text-primary mb-7 mb-md-5"},[t("span",{class:"border-primary pb-6"},"購物車一覽")],-1),kt={class:"d-flex align-items-end mb-2"},wt=t("span",{class:"material-symbols-outlined icon-semibold"},"undo",-1),At={class:"table-responsive mb-4"},Dt={class:"table align-middle table-white text-center fs-8 fs-md-7 mb-0",style:{"min-width":"696px"}},$t=t("thead",null,[t("tr",{class:"table-light bg-light"},[t("th",{scope:"col",width:"48px"}),t("th",{scope:"col",class:"d-none d-lg-table-cell"},"預覽"),t("th",{scope:"col"},"課程名稱"),t("th",{scope:"col"},"價格"),t("th",{scope:"col"},"人數"),t("th",{scope:"col"},"小計"),t("th",{scope:"col"},[t("div",{class:"d-none d-md-flex flex-column px-md-3"},"適用優惠")])])],-1),St={scope:"row"},qt=["onClick"],Bt=t("span",{class:"material-symbols-outlined icon-fill fs-5"},"delete_forever",-1),Ot=[Bt],It={class:"d-none d-lg-table-cell"},Mt=["src","alt"],jt={class:"d-flex flex-column"},Nt={key:0,class:"text-gray-400 text-decoration-line-through"},Vt={class:"select-icon d-inline-block",style:{width:"64px"}},Tt=["onUpdate:modelValue","onChange"],Lt=["value"],Ft={key:0,class:"text-danger d-block"},zt={class:"fs-8 px-md-3"},Pt={class:"row gy-4"},Ut={class:"col-12 col-md-6 text-center text-md-start"},Et={class:"col-8 col-sm-6 col-md-5 col-lg-4 col-xl-3 mx-auto me-md-0"},Jt={class:"list-group rounded-2 py-4 bg-body"},Rt={class:"list-group-item border-0 d-flex justify-content-between px-4 pb-2 fw-bold"},Gt={class:"text-end"},Ht={key:0,class:"list-group-item border-0 d-flex justify-content-between px-4 py-2 fw-bold"},Kt={class:"text-danger"},Qt={key:1,class:"list-group-item border-0 d-flex justify-content-between px-4 py-2 fw-bold"},Wt={class:"text-danger"},Xt={key:2,class:"list-group-item pt-2 px-4 border-0 d-flex justify-content-between fw-bold"},Yt={class:"text-end"},Zt={class:"col-12 text-center mt-7"},te=t("span",{class:"icon-e icon-east"},null,-1),ee={key:0,class:"mt-6 text-danger fs-8"};function se(e,c,_,k,r,a){const n=w("BackgroundBanner"),f=w("RouterLink"),M=w("CouponModal");return o(),l(g,null,[m(n,{bannerImg:r.bannerImg,class:"cart-banner"},null,8,["bannerImg"]),t("div",dt,[t("div",rt,[t("nav",ut,[t("ol",pt,[t("li",ht,[m(f,{to:"/"},{default:v(()=>[d("首頁")]),_:1})]),t("li",mt,[m(f,{to:"/products"},{default:v(()=>[d("購買課程")]),_:1})]),bt])]),r.cart.length?(o(),l("div",yt,[xt,Ct,t("div",kt,[m(f,{class:"text-decoration-underline d-inline-block me-auto fs-8 fs-lg-7",to:"/products"},{default:v(()=>[wt,d(" 返回課程列表 ")]),_:1}),t("button",{class:"btn btn-sm fs-7 btn-outline-danger shadow-sm px-3 fs-8 fs-lg-7",type:"button",onClick:c[0]||(c[0]=s=>e.deleteAllCart())}," 清空購物車 ")]),t("div",At,[t("table",Dt,[$t,t("tbody",null,[(o(!0),l(g,null,A(r.cart,s=>{var $,S,q;return o(),l("tr",{key:s.id},[t("th",St,[t("a",{href:"#",onClick:B(h=>e.deleteCart(s.id),["prevent"])},Ot,8,qt)]),t("td",It,[t("img",{src:s.product.imageUrl,alt:`product${s.id}`,class:"img-fluid",style:{"max-width":"150px","max-height":"100px"}},null,8,Mt)]),t("td",null,[m(f,{to:`/product/${s.product.id}`,class:"fw-bold"},{default:v(()=>[d(i(s.product.title),1)]),_:2},1032,["to"])]),t("td",null,[t("div",jt,[s.product.origin_price!==s.product.price?(o(),l("span",Nt,i(s.product.origin_price),1)):u("",!0),t("span",{class:y(`${s.product.origin_price!==s.product.price?"text-danger":!1}`)},i(s.product.price),3)])]),t("td",null,[t("div",Vt,[j(t("select",{class:"form-select form-select-sm fs-lg-7 pe-4 border-secondary","onUpdate:modelValue":h=>s.qty=h,onChange:h=>e.putCart(s.id,parseInt(s.qty))},[(o(!0),l(g,null,A(s.product.info.capacity-s.product.info.studentNum,h=>(o(),l("option",{value:h,key:h},i(h),9,Lt))),128))],40,Tt),[[N,s.qty]])])]),t("td",null,[t("span",{class:y({"text-gray-400 text-decoration-line-through":s.total!==s.subtotal})},i(s.total),3),s.total!==s.subtotal?(o(),l("span",Ft,i(s.subtotal),1)):u("",!0)]),t("td",zt,[t("p",null,[d(i(s.product.state.promotion?($=a.activities[s.product.state.promotion])==null?void 0:$.title:"－")+" ",1),t("span",{class:y(["d-block fs-9 mt-1",[s.qty<((S=e.numActivities[s.product.state.promotion])==null?void 0:S.requiredNum)?"text-danger":"text-gray-200"]])},i((q=a.activities[s.product.state.promotion])==null?void 0:q.description),3)])])])}),128))])])]),t("div",Pt,[t("div",Ut,[m(M,{"sum-subtotals":a.cartOverview.sumSubtotals},null,8,["sum-subtotals"])]),t("div",Et,[t("ul",Jt,[t("li",Rt,[d(" 小計總和： "),t("span",Gt,"NT$ "+i(a.cartOverview.sumSubtotals),1)]),e.couponDiscount?(o(),l("li",Ht,[d(" 優惠券折抵： "),t("span",Kt,"- "+i(e.couponDiscount),1)])):u("",!0),a.cartOverview.fullDiscount?(o(),l("li",Qt,[d(" 滿額折抵： "),t("span",Wt,"- "+i(a.cartOverview.fullDiscount),1)])):u("",!0),e.couponDiscount||a.cartOverview.fullDiscount?(o(),l("li",Xt,[d(" 折扣後金額： "),t("span",Yt,"NT$ "+i(a.cartOverview.finalBill),1)])):u("",!0)])]),t("div",Zt,[t("button",{class:"btn btn-primary fw-semibold",onClick:c[1]||(c[1]=B((...s)=>a.activeAlert&&a.activeAlert(...s),["prevent"])),style:{width:"240px"}},[d(" 前往結帳 "),te]),e.allActive.requiredPrice>a.cartOverview.finalBill?(o(),l("p",ee," 限時優惠："+i(e.allActive.description),1)):u("",!0)])])])):(o(),l("div",_t,[ft,gt,m(f,{to:"/products",class:"btn btn-primary-light mt-5",style:{width:"280px"}},{default:v(()=>[d(" 選購課程 "),vt]),_:1})]))])])],64)}const ce=I(ct,[["render",se]]);export{ce as default};
