import{_ as V,m as _,b as p,r as x,o as h,c as f,a as e,g as s,h as l,F as q,f as B,d as c,t as a,k as w,p as k,l as C,u as O}from"./index-686eedae.js";import{u as S}from"./useCartsStore-3a1c0605.js";import{u as D}from"./useCouponStore-e10688e8.js";const F={data(){return{hexApi:"https://ec-course-api.hexschool.io/v2/",apiPath:"2023shuttle",newOrderId:"",cart:[]}},computed:{..._(k,["alertstyles"]),..._(C,["cartData"]),..._(O,["allActive"]),..._(S,["cartOverview"]),..._(D,["couponDiscount"]),cartOverview(){const{requiredPrice:i,percentOff:r}=this.allActive;return this.countCart(this.couponDiscount,i,r)}},methods:{...p(k,["baseContent"]),...p(C,["getFontData"]),...p(O,["getActivities"]),...p(S,["countCart"]),...p(D,["getCookieCoupon","toggleCoupon","useCoupon"]),postOrder(i){const{name:r,tel:b,email:g,payment:m,message:o}=i,{sumSubtotals:u,couponDiscount:n,fullDiscount:d,finalBill:y}=this.cartOverview,t={data:{user:{name:r,tel:b,email:g,address:"none",userId:2,cartOverview:{sumSubtotals:u,couponDiscount:n,fullDiscount:d,finalBill:y}},payment:m,message:o}};this.axios.post(`${this.hexApi}api/${this.apiPath}/order`,t).then(v=>{const{orderId:A}=v.data;this.useCoupon(),document.cookie=`orderId=${A}; max-age=86400;Secure`,this.alertstyles.alert.fire({...this.baseContent(v.data.message,1),didClose:()=>{this.$router.replace({name:"order-established"}),this.getFontData("cart")}})}).catch(v=>{this.alertstyles.toast_danger.fire(`問題${v.response.status}，請洽客服`)})},onInvalidSubmit({errors:i}){const r=Object.keys(i)[0],b=document.querySelector(`#${r}`).getBoundingClientRect(),{scrollTop:g}=document.documentElement,m=b.top+g-226;window.scrollTo({top:m})}},watch:{cartData(i){this.cart=[...i]}},mounted(){this.getFontData("cart"),this.getCookieCoupon(),this.getActivities()}},j={class:"bg-white"},I={class:"block-spacing-sm container"},N={"aria-label":"breadcrumb",class:"mb-3"},E={class:"breadcrumb"},P={class:"breadcrumb-item"},T={class:"breadcrumb-item"},L={class:"breadcrumb-item"},R=e("li",{class:"breadcrumb-item active","aria-current":"page"},"填寫訂單",-1),M=e("div",{class:"w-100 w-md-75 d-flex flex-column mx-auto my-5"},[e("ol",{class:"d-flex justify-content-around ps-0 fs-7 fs-md-6 fw-bold"},[e("li",null,"訂單確認"),e("li",null,"填寫資料"),e("li",null,"訂單完成")]),e("div",{class:"progress border-dashed border-secondary"},[e("div",{class:"progress-bar",role:"progressbar",style:{width:"66.66%"},"aria-valuenow":"66.66","aria-valuemin":"0","aria-valuemax":"100"})])],-1),U={class:"row pt-lg-3"},$={class:"col-lg-6"},z={class:"d-flex flex-column h-100"},G=e("h4",{class:"text-center py-4"},[e("span",{class:"border-dashed-b pb-2"},"訂單內容")],-1),H={class:"table-responsive"},J={class:"table align-middle table-white text-center fs-8 fs-lg-7",style:{"min-width":"400px"}},K=e("thead",null,[e("tr",{class:"table-light bg-light"},[e("th",{scope:"col",width:"120px"},"預覽"),e("th",{scope:"col"},"課程名稱"),e("th",{scope:"col"},"人數"),e("th",{scope:"col",width:"96px"},"小計")])],-1),Q=["src","alt"],W={class:"text-start fw-bold"},X={class:"row justify-content-center align-items-end mx-sm-2"},Y={class:"col d-none d-sm-block"},Z=e("span",{class:"material-symbols-outlined icon-semibold"},"undo",-1),ee={class:"col-8 col-sm-6 col-md-5 col-lg-6 list-group rounded-2 py-4 bg-body"},te={class:"list-group-item border-0 d-flex justify-content-between px-4 pb-2 fw-bold"},se={class:"text-end"},oe={key:0,class:"list-group-item border-0 d-flex justify-content-between px-4 py-2 fw-bold"},ae={class:"text-danger"},le={key:1,class:"list-group-item border-0 d-flex justify-content-between px-4 py-2 fw-bold"},ie={class:"text-danger"},ne={class:"list-group-item pt-2 px-4 border-0 d-flex justify-content-between fw-bold"},re=e("span",{class:"fw-bold"},"應付金額",-1),ce={class:"col-lg-6 mt-4 mt-lg-0"},de={class:"bg-primary-light rounded-2 px-5 py-4"},ue=e("h4",{class:"text-center pb-4"},[e("span",{class:"border-dashed-b pb-2"},"填寫資料")],-1),me={class:"form-floating mb-4"},_e=e("label",{for:"name",class:"required"},"如何稱呼",-1),pe={class:"form-floating mb-4"},he=e("label",{for:"tel",class:"required"},"連絡電話",-1),fe={class:"form-floating mb-4"},be=e("label",{for:"email",class:"required"},"連絡信箱",-1),ge={class:"form-floating mb-4"},ve=e("option",{value:"",disabled:"",hidden:""},"請選擇付款方式",-1),xe=e("option",{value:"creditCard"},"信用卡",-1),ye=e("option",{value:"cash"},"現金",-1),we=e("option",{value:"transfer"},"帳戶匯款",-1),ke=e("option",{value:"linePay"},"Line Pay",-1),Ce=e("label",{for:"payment",class:"floating-select"},"付款方式",-1),Oe={class:"form-floating pb-3 mb-5"},Se=e("label",{for:"remark"},"備註",-1),De={class:"form-check mb-3"},Ae=e("label",{class:"form-check-label required",for:"isAgree"}," 我已閱讀並同意 課程注意事項 ",-1),Ve={class:"text-danger fs-9 ms-2"},qe=e("button",{class:"btn btn-primary w-100 mb-3 fs-6"},"資料送出",-1);function Be(i,r,b,g,m,o){const u=x("RouterLink"),n=x("VField"),d=x("ErrorMessage"),y=x("VForm");return h(),f("div",j,[e("div",I,[e("nav",N,[e("ol",E,[e("li",P,[s(u,{to:"/"},{default:l(()=>[c("首頁")]),_:1})]),e("li",T,[s(u,{to:"/products"},{default:l(()=>[c("購買課程")]),_:1})]),e("li",L,[s(u,{to:"/carts"},{default:l(()=>[c("購物車")]),_:1})]),R])]),M,e("div",U,[e("div",$,[e("div",z,[G,e("div",H,[e("table",J,[K,e("tbody",null,[(h(!0),f(q,null,B(m.cart,t=>(h(),f("tr",{key:t.id},[e("td",null,[e("img",{src:t.product.imageUrl,alt:`product${t.id}`,class:"img-fluid",style:{"max-width":"120px","max-height":"80px"}},null,8,Q)]),e("td",W,a(t.product.title),1),e("td",null,a(t.qty),1),e("td",null,a(t.subtotal),1)]))),128))])])]),e("div",X,[e("div",Y,[s(u,{class:"text-decoration-underline pt-3",to:"/carts"},{default:l(()=>[Z,c(" 返回購物車 ")]),_:1})]),e("ul",ee,[e("li",te,[c(" 小計總和： "),e("span",se,"NT$ "+a(o.cartOverview.sumSubtotals),1)]),o.cartOverview.couponDiscount?(h(),f("li",oe,[c(" 優惠券折抵： "),e("span",ae,"- "+a(o.cartOverview.couponDiscount),1)])):w("",!0),o.cartOverview.fullDiscount?(h(),f("li",le,[c(" 滿額折抵： "),e("span",ie,"- "+a(o.cartOverview.fullDiscount),1)])):w("",!0),e("li",ne,[re,c(" NT$"+a(o.cartOverview.finalBill),1)])])])])]),e("div",ce,[e("div",de,[ue,s(y,{novalidate:"",onSubmit:o.postOrder,onInvalidSubmit:o.onInvalidSubmit,class:"form-clear"},{default:l(()=>[e("div",me,[s(n,{name:"name",type:"text",rules:"required",class:"form-control fs-7",id:"name",placeholder:"name"}),_e,s(d,{name:"name"},{default:l(({message:t})=>[e("span",null,a(t.replace("name","名稱")),1)]),_:1})]),e("div",pe,[s(n,{name:"tel",type:"tel",rules:"required|numeric|length:10",class:"form-control fs-7",id:"tel",placeholder:"0912345678"}),he,s(d,{name:"tel"},{default:l(({message:t})=>[e("span",null,a(t.replace("tel","連絡電話")),1)]),_:1})]),e("div",fe,[s(n,{name:"email",type:"email",rules:"required|email",class:"form-control fs-7",id:"email",placeholder:"name@example.com"}),be,s(d,{name:"email"},{default:l(({message:t})=>[e("span",null,a(t.replace("email","信箱")),1)]),_:1})]),e("div",ge,[s(n,{name:"payment",rules:"required",as:"select",class:"form-select w-100 ps-3 lh-lg fs-7",id:"payment",placeholder:"付款方式"},{default:l(()=>[ve,xe,ye,we,ke]),_:1}),Ce,s(d,{name:"payment"},{default:l(({message:t})=>[e("span",null,a(t.replace("payment","付款方式")),1)]),_:1})]),e("div",Oe,[s(n,{name:"message",as:"textarea",type:"textarea",value:"",class:"form-control fs-7 text-wrap",id:"remark",placeholder:"備註欄位",style:{height:"116px"}}),Se]),e("div",De,[s(n,{name:"isAgree",rules:"required",type:"checkbox",id:"isAgree",class:"form-check-input",value:"isAgree"}),Ae,s(d,{name:"isAgree"},{default:l(()=>[e("span",Ve,a(i.message="請閱讀完後勾選"),1)]),_:1})]),s(n,{class:"d-none",name:"finalBill",type:"text",modelValue:o.cartOverview.finalBill,"onUpdate:modelValue":r[0]||(r[0]=t=>o.cartOverview.finalBill=t)},null,8,["modelValue"]),qe]),_:1},8,["onSubmit","onInvalidSubmit"])])])])])])}const Ne=V(F,[["render",Be]]);export{Ne as default};
