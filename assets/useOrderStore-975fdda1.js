import{E as l,G as s,H as c}from"./index-9450ee47.js";const d="https://sideproject-shuttle.onrender.com",i="https://ec-course-api.hexschool.io/v2/",a="2023shuttle",u=document.cookie.replace(/(?:(?:^|.*;\s*)userId\s*=\s*([^;]*).*$)|^.*$/,"$1"),p=l("orders",{state:()=>({orderInfo:{user:{}},orders:[],calenderEvents:[]}),actions:{postOrder(e){const t={data:{user:{name:e.名稱,email:e.連絡信箱,tel:e.連絡電話,address:"none",userId:u},message:e.備註,payment:e.付款方式,finalBill:e.finalBill}};s.post(`${i}api/${a}/order`,t).then(r=>{const o=r.data.orderId;document.cookie="couponDiscount=;",document.cookie=`newOrderId=${o}; max-age=86400;Secure`,this.fixBill(e.finalBill,o),c.fire({icon:"success",confirmButtonText:"確認",title:r.data.message,didClose:()=>{this.router.push({name:"order-established"})}})}).catch(r=>{c.fire(`問題${r.response.status}，請洽客服`)})},fixBill(e,t){const r={id:t,total:e};s.post(`${d}/ordersFinalBill`,r)},getfixBill(){s.get(`${d}/ordersFinalBill`).then(e=>{const t=[...e.data].reverse();this.orders.forEach((r,o)=>{r.finalBill=t[o].total})})},getOrder(e){s.get(`${i}api/${a}/order/${e}`).then(t=>{this.orderInfo=t.data.order})},getOrders(){s.get(`${i}api/${a}/orders`).then(e=>{this.orders=e.data.orders,this.orders.forEach(t=>{t.products=Object.values(t.products)}),this.getfixBill(),this.calenderEvent()})},calenderEvent(){const e=[];this.orders.forEach(t=>{e.push(...t.products)}),this.calenderEvents=e.map(t=>{const r={title:"",start:"",end:"",description:"",borderColor:"var(--bs-success)",startStr:""};return r.title=t.product.title,r.description=`${t.qty} 位學員`,t.product.info.ClassTime.forEach(o=>{const n=this.countDate(o[0]);r.start=`${n} ${this.countTime(o[0])}`,r.end=`${n} ${this.countTime(o[1])}`,r.startStr=`${r.end}~${this.countTime(o[0])}`}),r})},countDate(e){const t=new Date(e*1e3),r=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0");return`${r}-${o}-${n}`},countTime(e){const t=new Date(e*1e3),r=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0");return`${r}:${o}`}}});export{p as u};
