import{B}from"./BackgroundBanner-c97d28e3.js";import{_ as $,e as w,f as a,g as c,k as f,i as t,l as v,x as b,F as x,j as y,y as C,A as T,s as u,t as l,v as m,u as k,z as N}from"./index-26ca2814.js";const h="https://ec-course-api.hexschool.io/v2/",_="2023shuttle",j={emits:["updateUserId","cartsContent"],props:["nowCarts"],components:{BackgroundBanner:B},data(){return{bannerImg:"background-image: url(/banner/banner-carts.jpg)",carts:[],totalBill:0,coupon:0,couponCode:"",promotions:{unlimitedActives:{promotion01:{title:"2023 秋冬新色早鳥優惠",description:"對象商品現打九折",percentOff:.9,checkLimits(s){return s*this.percentOff}}},numActives:{promotion03:{title:"2023 夏季織心好友揪團趣",description:"兩人現打八五折",requiredNum:2,percentOff:.85,checkLimits(s,o){return s>=this.requiredNum?Math.round(o*this.percentOff):s}}},totalActive:{title:"2023 歲末全館回饋季",description:"滿 3000 折 300，可累計折抵（排除優惠券折扣）",requiredPrice:3e3,percentOff:300,totalActive(s,o){let n=s-o,r=0;if(n<3e3)return{discount:r,difference:3e3-n};for(;n>=3e3;)n-=3e3,r+=300;return console.log(n,r),{discount:r,difference:3e3-n%3e3}}}}}},methods:{getCarts(){this.axios.get(`${h}api/${_}/cart`).then(s=>{this.carts=s.data.data.carts,console.log(this.carts),this.carts.forEach(o=>{if(o.product.state.promotions={},o.product.state.promotion)switch(o.product.state.promotion){case"promotion01":o.product.state.promotionType="unlimitedActive";break;case"promotion03":o.product.state.promotionType="numActive";break}o.product.price=o.product.origin_price,o.product.state.promotionType==="unlimitedActive"&&(o.product.price=this.promotions.unlimitedActives[o.product.state.promotion].checkLimits(o.product.origin_price),o.total=o.product.price*o.qty),o.final_total=o.total,o.product.state.promotionType==="numActive"&&(o.final_total=this.promotions.numActives[o.product.state.promotion].checkLimits(o.qty,o.total))}),this.totalBill=s.data.data.total,this.$swal({position:"bottom-end",title:`${this.promotions.totalActive.title}`,html:`<p class='text-gray-400'>${this.promotions.totalActive.description}</p><p>目前金額再 <span class='text-danger'>NT$ ${this.promotions.totalActive.totalActive(this.totalBill,this.coupon).difference} </span>即可折抵 NT$ 300 </p>`,showConfirmButton:!1,backdrop:!1,showCloseButton:!0,width:"40%"})}).catch(s=>{console.log(s.response)})},putCarts(s,o){const n={data:{product_id:s,qty:o}};this.axios.put(`${h}api/${_}/cart/${s}`,n).then(()=>{this.getCarts()}).catch(r=>{console.log(r.response)})},deleteCarts(s){this.axios.delete(`${h}api/${_}/cart/${s}`).then(o=>{this.$swal({title:o.data.message,didClose:()=>{this.getCarts()}})}).catch(o=>{this.$swal({icon:"error",title:o.response.data.message})})},deleteAllCarts(){this.axios.delete(`${h}api/${_}/carts`).then(s=>{this.$swal({title:s.data.message,didClose:()=>{this.getCarts()}})}).catch(s=>{this.$swal({icon:"error",title:s.response.data.message})})},showPromotion(s,o){if(s&&o){const n=o,r=s;return this.promotions[`${n}s`][r]}return!1},postCoupon(s){const o={data:{code:s}};this.axios.post(`${h}api/${_}/coupon`,o).then(n=>{this.coupon=this.totalBill-n.data.data.final_total,this.$swal({icon:"success",title:n.data.message,showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutDown"},didClose:()=>{this.getCarts()}})}).catch(n=>{this.$swal({icon:"error",title:n.response.data.message})})},emitCartsContent(s,o){this.$emit("cartsContent",{carts:this.carts,totalBill:s,coupon:o,activeDiscount:this.promotions.totalActive.totalActive(s,o)}),this.$router.push("/order")}},mounted(){this.getCarts()},beforeRouteLeave(s,o,n){this.$swal.close(),this.$emit("cartsContent",{carts:this.carts,totalBill:this.totalBill,coupon:this.coupon,activeDiscount:this.promotions.totalActive.totalActive(this.totalBill,this.coupon)}),n()}},V={class:"bg-white"},q={class:"block-spacing-sm container"},L={"aria-label":"breadcrumb",class:"mb-3"},I={class:"breadcrumb"},D={class:"breadcrumb-item"},O={class:"breadcrumb-item"},P=t("li",{class:"breadcrumb-item active","aria-current":"page"},"購物車",-1),U=t("div",{class:"w-100 w-md-75 d-flex flex-column mx-auto my-5"},[t("ol",{class:"d-flex justify-content-around ps-0 fs-6 fw-bold"},[t("li",null,"訂單確認"),t("li",null,"填寫資料"),t("li",null,"訂單完成")]),t("div",{class:"progress border-dashed border-secondary"},[t("div",{class:"progress-bar",role:"progressbar",style:{width:"33.33%"},"aria-valuenow":"33.33","aria-valuemin":"0","aria-valuemax":"100"})])],-1),M={class:"d-flex align-items-center mb-2"},R=t("span",{class:"material-symbols-outlined icon-semibold"}," undo ",-1),z={class:"table-responsive-sm"},E={class:"table align-middle table-white text-center fs-8 fs-lg-7"},F=t("thead",null,[t("tr",{class:"table-light bg-light"},[t("th",{scope:"col"}),t("th",{scope:"col"},[t("div",{class:"d-none d-md-flex flex-column"},"預覽")]),t("th",{scope:"col"},"課程名稱"),t("th",{scope:"col"},"價格"),t("th",{scope:"col"},"人數"),t("th",{scope:"col"},"小計"),t("th",{scope:"col"},[t("div",{class:"d-none d-md-flex flex-column px-md-3"},"適用優惠")])])],-1),S={scope:"row"},G=["onClick"],H=t("span",{class:"material-symbols-outlined icon-fill fs-5"}," delete_forever ",-1),J=[H],K={class:"d-none d-md-flex flex-column align-items-center"},Q=["src","alt"],W={class:"d-flex flex-column"},X={key:0,class:"text-gray-400 text-decoration-line-through"},Y={class:"select-icon"},Z=["onUpdate:modelValue","onChange"],tt=["value"],ot={class:"d-flex flex-column"},et={key:0,class:"text-gray-400 text-decoration-line-through"},st={class:"fs-8 px-md-3"},it={key:0,class:"d-none d-md-flex flex-column"},nt={class:"text-gray-200 fs-9 fw-light"},lt={class:"row mb-4 pb-md-3 pt-2"},at={class:"col-10 col-md-5"},ct={class:"input-group mb-3 mb-lg-4"},rt={class:"col-8 col-sm-6 col-md-5 col-lg-4 col-xl-3 ms-auto"},dt={class:"list-group rounded-2 bg-secondary"},pt={class:"list-group-item pt-3 border-0 text-mellow d-flex justify-content-between"},ut=t("span",{class:"fw-bold"},"目前總金額",-1),mt={key:0,class:"list-group-item border-0 d-flex justify-content-between"},ht=t("span",{class:"fw-bold"},"優惠券折抵",-1),_t={class:"text-danger"},ft={key:1,class:"list-group-item border-0 d-flex justify-content-between"},bt=t("span",{class:"fw-bold"},"滿額折抵",-1),gt={class:"text-danger"},vt={class:"list-group-item pb-3 border-0 d-flex justify-content-between"},xt=t("span",{class:"fw-bold"},"折扣後金額",-1),wt={class:"d-flex"};function yt(s,o,n,r,i,d){const A=w("BackgroundBanner"),g=w("RouterLink");return a(),c(x,null,[f(A,{bannerImg:i.bannerImg,class:"cart-banner"},null,8,["bannerImg"]),t("div",V,[t("div",q,[t("nav",L,[t("ol",I,[t("li",D,[f(g,{to:"/"},{default:v(()=>[u("首頁")]),_:1})]),t("li",O,[f(g,{to:"/products"},{default:v(()=>[u("購買課程")]),_:1})]),P])]),U,t("div",M,[f(g,{class:"text-decoration-underline d-inline-block me-auto",to:"/products"},{default:v(()=>[R,u(" 返回課程列表 ")]),_:1}),t("a",{class:"btn btn-sm btn-outline-primary px-3 fw-normal d-inline-block shadow-none",href:"#",onClick:o[0]||(o[0]=b(e=>d.deleteAllCarts(),["prevent"]))}," 清空購物車 ")]),t("div",z,[t("table",E,[F,t("tbody",null,[(a(!0),c(x,null,y(i.carts,e=>(a(),c("tr",{key:e.id},[t("th",S,[t("a",{href:"#",onClick:b(p=>d.deleteCarts(e.id),["prevent"])},J,8,G)]),t("td",null,[t("div",K,[t("img",{src:e.product.imageUrl,alt:`product${e.id}`,class:"img-fluid",style:{"max-width":"150px"}},null,8,Q)])]),t("td",null,l(e.product.title),1),t("td",null,[t("div",W,[e.product.origin_price!==e.product.price?(a(),c("span",X,l(e.product.origin_price),1)):m("",!0),t("span",{class:k(`${e.product.origin_price!==e.product.price?"text-danger":!1}`)},l(e.product.price),3)])]),t("td",null,[t("div",Y,[C(t("select",{class:"form-select form-select-sm fs-lg-7 pe-4 border-secondary","onUpdate:modelValue":p=>e.qty=p,onChange:p=>d.putCarts(e.id,parseInt(e.qty))},[(a(!0),c(x,null,y(e.product.info.capacity-e.product.info.studentNum,p=>(a(),c("option",{value:p,key:p},l(p),9,tt))),128))],40,Z),[[N,e.qty]])])]),t("td",null,[t("div",ot,[e.final_total!==e.total?(a(),c("span",et,l(e.total),1)):m("",!0),t("span",{class:k(`${e.final_total!==e.total?"text-danger":!1}`)},l(e.final_total),3)])]),t("td",st,[d.showPromotion(e.product.state.promotion,e.product.state.promotionType)?(a(),c("div",it,[u(l(d.showPromotion(e.product.state.promotion,e.product.state.promotionType).title)+" ",1),t("span",nt,l(d.showPromotion(e.product.state.promotion,e.product.state.promotionType).description),1)])):m("",!0)])]))),128))])])]),t("div",lt,[t("div",at,[t("div",ct,[C(t("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>i.couponCode=e),type:"text",class:"form-control fs-7",placeholder:"請輸入折扣碼","aria-label":"coupon number","aria-describedby":"coupon-btn"},null,512),[[T,i.couponCode]]),t("button",{class:"btn btn-secondary shadow-none py-2 fs-7",type:"button",id:"coupon-btn",onClick:o[2]||(o[2]=b(e=>d.postCoupon(i.couponCode),["prevent"]))}," 確認使用 ")])]),t("div",rt,[t("ul",dt,[t("li",pt,[ut,u("NT$ "+l(i.totalBill),1)]),i.coupon?(a(),c("li",mt,[ht,t("span",_t,"NT$ - "+l(i.coupon),1)])):m("",!0),i.promotions.totalActive?(a(),c("li",ft,[bt,t("span",gt,"NT$ - "+l(i.promotions.totalActive.totalActive(i.totalBill,i.coupon).discount),1)])):m("",!0),t("li",vt,[xt,u("NT$ "+l(i.totalBill!==0?i.totalBill-i.coupon-i.promotions.totalActive.totalActive(i.totalBill,i.coupon).discount:0),1)])])])]),t("div",wt,[t("button",{class:"btn btn-primary fs-7 fs-lg-6 fw-normal w-75 w-md-50 w-lg-25 mx-auto",onClick:o[3]||(o[3]=b(e=>d.emitCartsContent(i.totalBill,i.coupon),["prevent"]))}," 訂單確認 ")])])])],64)}const At=$(j,[["render",yt]]);export{At as default};
