import{m as w,b as x,M as B,_ as P,p as T,r as g,o as l,c,a as e,t as a,g as y,h as M,n as C,k as p,F as f,f as k,j as F,e as V,E as L,D as $,l as j,u as q,d as D}from"./index-686eedae.js";import{u as N}from"./useProductsStore-08c41425.js";import{u as E}from"./utilitiesStore-1f9ae4ab.js";import{m as I}from"./memberStore-4686b46c.js";import{M as R}from"./MemberNavs-3025e7ae.js";import{S as z,a as G,P as J}from"./pagination-6ff3ec02.js";import{P as W}from"./ProductModal-8a8b5a57.js";const H={components:{Swiper:z,SwiperSlide:G},props:["clickedCourse"],data(){return{url:"https://sideproject-shuttle.onrender.com",modal:null,comment:{orderId:"",productId:"",imgUrls:[],agreeToShare:!1,satisfaction:{content:null,process:null,quality:null,recommend:null},describe:""},imgFile:null,swiper:null,modules:[J],satisfactionOption:[{label:"課程內容",id:"content"},{label:"流程設計",id:"process"},{label:"教學品質",id:"quality"},{label:"值得推薦",id:"recommend"}]}},computed:{...w(I,["userComments"]),...w(T,["alertstyles"])},methods:{...x(I,["postComment"]),...x(T,["baseContent"]),onSwiper(t){this.swiper=t},imgToFormData(t){const n=t.target.files[0];this.imgFile=n,this.comment.imgUrls.push(URL.createObjectURL(n))},userAddImg(){const t=new FormData,n=new Date().getTime();t.append("image",this.imgFile),t.append("type","image"),t.append("title",`心得圖片-${n}`),t.append("description","Shuttle side project 儲存用戶端上傳圖片"),t.append("album","TtjzDJS"),this.axios.post("https://api.imgur.com/3/image",t,{headers:{Authorization:"Bearer a613a90a6ef64bac02f6ab85e98c34e94587a48d","Content-Type":"multipart/form-data"}}).then(o=>{this.alertstyles.toast.fire(this.baseContent("新增成功"));const{link:_}=o.data.data,s=this.comment.imgUrls.length;this.comment.imgUrls[s-1]=_,document.querySelector("#addImgInput").value=""}).catch(o=>{this.alertstyles.toast_danger.fire(this.baseContent(`新增失敗 問題${o.response.status}`))})}},watch:{clickedCourse(t){t.isCommented?this.comment={...this.userComments.find(n=>n.orderId===t.id)}:(this.comment.orderId=t.id,this.comment.productId=t.product_id)}},mounted(){this.modal=new B(document.getElementById("commentModal"));const t="_element";this.modal[t].addEventListener("hidden.bs.modal",()=>{const{comment:n}=this.$options.data();this.clickedCourse.isCommented?this.comment={...n}:(this.$refs.commentForm.resetForm(),this.comment.imgUrls=[...n.imgUrls],this.comment.agreeToShare=n.agreeToShare),document.querySelector("#addImgInput").value=""})}},K={class:"modal fade",id:"commentModal",tabindex:"-1"},Q={class:"modal-dialog modal-dialog-scrollable modal-lg"},X={class:"modal-content"},Y={class:"modal-header bg-primary border-dashed border-white border-bottom-0 pb-3"},Z={class:"modal-title fs-6 text-white"},ee={class:"modal-body p-5"},te={class:"row gy-7"},se={class:"col-lg-6 d-flex flex-column justify-content-between"},oe={class:"d-flex align-items-end mb-2"},ne={key:0,class:"ms-3 text-danger"},ie=e("p",{class:"fs-8 mb-3"},"1 為「非常不滿意」，5 為「非常滿意」。",-1),le={class:"table text-center mb-0"},ce={class:"border-gray-200"},re=e("th",{scope:"col",width:"86",class:"fw-normal"},"選項",-1),de={scope:"col"},ae=e("th",{scope:"col"},"2",-1),me=e("th",{scope:"col"},"3",-1),ue=e("th",{scope:"col"},"4",-1),he=e("th",{scope:"col"},"5",-1),_e={scope:"row"},pe=["for"],be={key:1},ge={class:"col-lg-6"},fe={class:"mb-2"},ye=e("label",{class:"fs-8 mb-3",for:"feedback"},"自由填寫課後心得或建議",-1),Ce={key:1,class:"px-4 py-3 border border-gray-200 rounded-1",style:{height:"180px"}},ke={class:"col-lg-10"},we={class:"mb-0 mb-2"},xe={key:0,class:"d-flex aling-items-center ms-2 mb-3"},ve=e("label",{class:"fs-8",for:"agreeShare"}," 我同意提供分享的照片，作為 Shuttle 宣傳之用。 ",-1),Oe={class:"input-group fs-7 ms-2"},Se=["disabled"],Me={class:"col-12 mt-3"},Ue=["src","alt"],De={key:1,class:"bg-dark bg-opacity-25 rounded-1 d-flex justify-content-center"},Ie=e("span",{class:"py-5"},"沒有上傳任何圖片",-1),Fe=[Ie],Te={type:"submit",class:"d-none",ref:"submitBtn"},Ve={class:"modal-footer bg-white border-0 pt-3 text-center"},je=e("button",{type:"button",class:"btn btn-outline-secondary fs-7 py-2","data-bs-dismiss":"modal"}," 關閉 ",-1);function Ne(t,n,o,_,s,d){var U,S;const b=g("VField"),h=g("swiper-slide"),v=g("swiper"),O=g("VForm");return l(),c("div",K,[e("div",Q,[e("div",X,[e("div",Y,[e("h4",Z,"課程名稱："+a((S=(U=o.clickedCourse)==null?void 0:U.product)==null?void 0:S.title),1)]),e("div",ee,[y(O,{novalidate:"",onSubmit:n[3]||(n[3]=i=>t.postComment({...s.comment},s.modal)),class:"contanier overflow-hidden",ref:"commentForm"},{default:M(({errors:i})=>[e("div",te,[e("div",se,[e("div",oe,[e("h5",{class:C(["mb-0",{required:!o.clickedCourse.isCommented}])},a(o.clickedCourse.isCommented?"您的評價":"滿意度調查"),3),Object.keys(i).length?(l(),c("span",ne," 請確認是否填寫完整 ")):p("",!0)]),ie,e("table",le,[e("thead",null,[e("tr",ce,[re,e("th",de,a(o.clickedCourse.isCommented?"滿意度":"1"),1),o.clickedCourse.isCommented?p("",!0):(l(),c(f,{key:0},[ae,me,ue,he],64))])]),e("tbody",null,[(l(!0),c(f,null,k(s.satisfactionOption,r=>(l(),c("tr",{key:r.id,class:"border-light"},[e("th",_e,[e("label",{class:"form-check-label",for:r.id},a(r.label),9,pe)]),o.clickedCourse.isCommented?(l(),c("td",be,[(l(),c(f,null,k(5,m=>e("i",{class:C(["bi mx-1 text-warning",[m<=s.comment.satisfaction[r.id]?"bi-star-fill":"bi-star"]]),key:m},null,2)),64))])):(l(),c(f,{key:0},k(5,m=>e("td",{key:m},[y(b,{rules:"required",name:r.id,type:"radio",value:m,id:m===5?r.id:"",class:"form-check-input",modelValue:s.comment.satisfaction[r.id],"onUpdate:modelValue":u=>s.comment.satisfaction[r.id]=u},null,8,["name","value","id","modelValue","onUpdate:modelValue"])])),64))]))),128))])])]),e("div",ge,[e("h5",fe,a(o.clickedCourse.isCommented?"您的意見":"意見反饋"),1),ye,o.clickedCourse.isCommented?(l(),c("p",Ce,a(s.comment.describe?s.comment.describe:"無相關評論"),1)):(l(),F(b,{key:0,as:"textarea",class:"form-control fs-7 bg-white",name:"feedback",id:"feedback",style:{height:"180px"},modelValue:s.comment.describe,"onUpdate:modelValue":n[0]||(n[0]=r=>s.comment.describe=r)},null,8,["modelValue"]))]),e("div",ke,[e("h5",we,a(o.clickedCourse.isCommented?"照片集":"分享照片"),1),o.clickedCourse.isCommented?p("",!0):(l(),c("div",xe,[V(e("input",{class:"form-check-input fs-8 me-1",type:"checkbox",id:"agreeShare","onUpdate:modelValue":n[1]||(n[1]=r=>s.comment.agreeToShare=r)},null,512),[[L,s.comment.agreeToShare]]),ve])),V(e("div",Oe,[y(b,{name:"imgUrl",type:"file",id:"addImgInput",class:"form-control fs-7 bg-white py-2",accept:"image/*",onChange:d.imgToFormData},null,8,["onChange"]),e("button",{class:"btn btn-primary fs-7 fw-medium py-2 px-4 rounded-end-1 shadow-none",type:"button",onClick:n[2]||(n[2]=(...r)=>d.userAddImg&&d.userAddImg(...r)),disabled:!s.comment.imgUrls.some(r=>r.startsWith("blob"))}," 上傳檔案 ",8,Se)],512),[[$,!o.clickedCourse.isCommented]])]),e("div",Me,[s.comment.imgUrls.length?(l(),F(v,{key:0,class:C(["comment-swiper",{"pb-7":s.comment.imgUrls.length>2,"pb-lg-0":s.comment.imgUrls.length>2&&s.comment.imgUrls.length<=4}]),spaceBetween:12,noSwiping:!0,pagination:!0,modules:s.modules,onSwiper:d.onSwiper,slidesPerView:2,breakpoints:{992:{slidesPerView:4}}},{default:M(()=>[s.comment.imgUrls.length?(l(!0),c(f,{key:0},k(s.comment.imgUrls,(r,m)=>(l(),F(h,{key:m},{default:M(()=>[e("img",{src:r,alt:`課程照片${m+1}`,style:{height:"105px"},class:"shadow-sm bg-white",referrerpolicy:"no-referrer",id:"123"},null,8,Ue)]),_:2},1024))),128)):p("",!0)]),_:1},8,["class","modules","onSwiper"])):(l(),c("div",De,Fe))])]),e("button",Te,null,512)]),_:1},512)]),e("div",Ve,[je,o.clickedCourse.isCommented?p("",!0):(l(),c("button",{key:0,onClick:n[4]||(n[4]=i=>this.$refs.submitBtn.click()),type:"button",class:"btn btn-primary fs-7 py-2 ms-2"}," 送出 "))])])])])}const Pe=P(H,[["render",Ne]]);const Ae={components:{MemberNavs:R,CommentModal:Pe,ProductModal:W},data(){return{isOrdersMode:!0,clickedCourse:{},orders:null,courses:null,orderOption:["全部訂單","未付款訂單"],courseOption:["所有課程","未開課","授課中","已完課"],nowOption:"全部訂單"}},methods:{...x(j,["getFontData"]),...x(I,["getUserCommits"]),...x(N,["getProduct"]),...x(E,["unixToStr"]),getOption(t){this.nowOption=t},switchMode(){this.isOrdersMode=!this.isOrdersMode,this.isOrdersMode?this.nowOption="全部訂單":this.nowOption="所有課程"},findRecentCourse(t){const o=t.flat(),[_]=o;let s=0,d=null;const b=["開課日","今日上課","下節課程","完課"];if(_<=1720098002&&o[o.length-1]>=1720098002){const h=o.findIndex((v,O)=>v<=1720098002&&o[O+1]>=1720098002);s=h%2?2:1,d=h%2?o[h+1]:o[h]}return o.every(h=>h<1720098002)&&(s=3,d=o[o.length-1]),o.every(h=>h>1720098002)&&(d=_),{stateCode:s,caption:b[s],date:this.unixToStr(d,!1)}},fixSubtotal(t){const{promotion:n}=t.product.state,o=Object.keys(this.numActivities)[0],{percentOff:_}=this.numActivities[o];return n===o?t.final_total*_:t.final_total},checkIsCommented(t,n){return t.some(o=>o.orderId===n.id)}},computed:{...w(N,["singleProduct"]),...w(j,["remoteData"]),...w(I,["userComments"]),...w(q,["numActivities"]),navsOption(){return this.isOrdersMode?this.orderOption:this.courseOption},filteredList(){switch(this.nowOption){case this.orderOption[1]:return this.orders.filter(t=>!t.is_paid);case this.courseOption[0]:return this.courses;case this.courseOption[1]:return this.courses.filter(t=>t.recentCourse.stateCode===0);case this.courseOption[2]:return this.courses.filter(t=>t.recentCourse.stateCode>1&&t.recentCourse.stateCode<3);case this.courseOption[3]:return this.courses.filter(t=>t.recentCourse.stateCode===3);default:return this.orders}}},watch:{remoteData(t){this.orders=[...t].map(n=>{const o={...n};return Object.values(n.products).forEach(s=>{const{classTime:d}=s.product.info;o.products[s.id].recentCourse=this.findRecentCourse(d),o.products[s.id].isCommented=this.checkIsCommented(this.userComments,s)}),o}),this.courses=t.map(n=>Object.values(n.products)).flat()},userComments(t){var n;(n=this.orders)!=null&&n.length&&this.orders.forEach((o,_)=>{Object.values(o.products).forEach(d=>{this.orders[_].products[d.id].isCommented=t.some(b=>b.productId===d.product_id)})})}},mounted(){this.getFontData("orders"),this.getUserCommits()}},Be={class:"form-check form-switch mt-2 mb-3 ms-3"},Le={class:"form-check-label",for:"displaySwitch"},$e={class:"bg-white py-2 px-5"},qe={key:0,class:"d-flex flex-column align-items-center py-5 lh-1"},Ee=e("i",{class:"bi bi-journal-x text-gray-200 p-4 rounded-circle my-4",style:{"font-size":"92px",border:"6px solid var(--bs-gray-100)"}},null,-1),Re=e("h3",null,"目前沒有任何訂單",-1),ze=e("span",{class:"icon-e icon-east"},null,-1),Ge={key:1,class:"list-unstyled"},Je={class:"fs-7 mb-0 p-3 bg-light"},We={class:"table table-white text-center align-middle mb-0"},He=e("thead",{class:"d-none"},[e("tr",null,[e("th",{scope:"col"},"預覽圖片"),e("th",{scope:"col"},"課程名稱"),e("th",{scope:"col"},"報名人數"),e("th",{scope:"col"},"小計"),e("th",{scope:"col"})])],-1),Ke={width:"180"},Qe=["src","alt"],Xe={class:"fs-7 mb-0 text-start"},Ye={class:"text-end"},Ze={width:"160"},et=["onClick"],tt=["onClick"],st={colspan:"2",class:"text-start"},ot=e("span",{class:"icon-e icon-east"},null,-1),nt={colspan:"3",class:"text-end"},it={key:0,class:"badge bg-danger bg-opacity-25 text-danger rounded-1 fs-9 fw-bold me-1"},lt={key:2,class:"last-tr-borderless table my-4 table-white text-center align-middle"},ct=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"近期開課"),e("th",{scope:"col"},"預覽圖片"),e("th",{scope:"col"},"課程名稱"),e("th",{scope:"col"},"人數"),e("th",{scope:"col"},"小計"),e("th",{scope:"col"})])],-1),rt={class:"d-flex flex-column align-items-center fs-7"},dt={key:0,class:"fs-6"},at={width:"120"},mt=["src","alt"],ut={class:"fs-7 mb-0"},ht={class:"text-end"},_t={width:"160"},pt=["onClick"],bt=["onClick"];function gt(t,n,o,_,s,d){var S;const b=g("MemberNavs"),h=g("RouterLink"),v=g("router-link"),O=g("ProductModal"),U=g("CommentModal");return l(),c(f,null,[e("div",Be,[e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"displaySwitch",onClick:n[0]||(n[0]=i=>d.switchMode())}),e("label",Le,a(`切換成「${s.isOrdersMode?"個別課程":"訂單編號"}」模式`),1)]),y(b,{options:d.navsOption,"now-option":s.nowOption,onGetOption:d.getOption},null,8,["options","now-option","onGetOption"]),e("div",$e,[(S=s.orders)!=null&&S.length?p("",!0):(l(),c("div",qe,[Ee,Re,y(h,{to:"/products",class:"btn btn-primary-light mt-3",style:{width:"280px"}},{default:M(()=>[D(" 選購課程 "),ze]),_:1})])),s.isOrdersMode?(l(),c("ul",Ge,[(l(!0),c(f,null,k(d.filteredList,i=>{var r,m;return l(),c("li",{class:"py-4 border-dashed-b border-gray-100",key:i.id},[e("h2",Je,[D(" 訂單編號："+a(i.id)+" ",1),e("span",{class:C(["badge text-white ms-2 rounded-1",[i.is_paid?"bg-success":"bg-danger"]])},a(i.is_paid?"付款完成":"未付款"),3)]),e("table",We,[He,e("tbody",null,[(l(!0),c(f,null,k(i.products,u=>(l(),c("tr",{key:u.id},[e("td",Ke,[e("img",{src:u.product.imageUrl,alt:u.product.title,style:{height:"100px"}},null,8,Qe)]),e("td",null,[e("h3",Xe,a(u.product.title),1)]),e("td",null,a(u.qty)+" 位",1),e("td",Ye,"NT$ "+a(d.fixSubtotal(u)),1),e("td",Ze,[e("button",{type:"button",class:"btn btn-outline-primary p-2 mx-2 w-75 fs-8 shadow-none","data-bs-toggle":"modal","data-bs-target":"#productInfo",onClick:A=>s.clickedCourse={...u}}," 課程資訊 ",8,et),u.recentCourse.stateCode===3?(l(),c("button",{key:0,type:"button",class:C(["btn p-2 mx-2 w-75 fs-8 shadow-none mt-2",[u.isCommented?"btn-primary-light":"btn-primary"]]),"data-bs-toggle":"modal","data-bs-target":"#commentModal",onClick:A=>s.clickedCourse={...u}},a(u.isCommented?"查看心得":"填寫心得"),11,tt)):p("",!0)])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",st,[y(v,{class:"btn btn-primary-light py-2 fs-8 shadow-none",to:`/member/order/${i.id}`},{default:M(()=>[D(" 前往訂單明細 "),ot]),_:2},1032,["to"])]),e("td",nt,[i.user.cartOverview.couponDiscount||i.user.cartOverview.fullDiscount?(l(),c("span",it," 已扣除額外折扣：- "+a(i.user.cartOverview.couponDiscount+i.user.cartOverview.fullDiscount),1)):p("",!0),D(" 訂單總金額：NT$ "+a((m=(r=i==null?void 0:i.user)==null?void 0:r.cartOverview)==null?void 0:m.finalBill),1)])])])])])}),128))])):(l(),c("table",lt,[ct,e("tbody",null,[(l(!0),c(f,null,k(d.filteredList,(i,r)=>(l(),c("tr",{key:r},[e("td",null,[e("small",rt,[e("span",{class:C(["badge rounded-1 mb-2",{"bg-success text-white":i.recentCourse.stateCode===0,"bg-primary text-white":i.recentCourse.stateCode===1,"bg-warning":i.recentCourse.stateCode===2,"bg-primary-light":i.recentCourse.stateCode===3}]),style:{"letter-spacing":"1.2px"}},a(i.recentCourse.caption),3),i.recentCourse.stateCode!==3?(l(),c("span",dt,a(i.recentCourse.date),1)):p("",!0)])]),e("td",at,[e("img",{src:i.product.imageUrl,alt:i.product.title,style:{height:"100px"}},null,8,mt)]),e("td",null,[e("h2",ut,a(i.product.title),1)]),e("td",null,a(i.qty)+" 位",1),e("td",ht,"NT$ "+a(d.fixSubtotal(i)),1),e("td",_t,[e("button",{type:"button",class:"btn btn-outline-primary p-2 mx-2 w-75 fs-8 shadow-none","data-bs-toggle":"modal","data-bs-target":"#productInfo",onClick:m=>s.clickedCourse={...i}}," 課程資訊 ",8,pt),i.recentCourse.stateCode===3?(l(),c("button",{key:0,type:"button",class:C(["btn p-2 mx-2 w-75 fs-8 shadow-none mt-2",[i.isCommented?"btn-primary-light":"btn-primary"]]),"data-bs-toggle":"modal","data-bs-target":"#commentModal",onClick:m=>s.clickedCourse={...i}},a(i.isCommented?"查看心得":"填寫心得"),11,bt)):p("",!0)])]))),128))])]))]),y(O,{"clicked-course":s.clickedCourse},null,8,["clicked-course"]),y(U,{"clicked-course":s.clickedCourse},null,8,["clicked-course"])],64)}const Ot=P(Ae,[["render",gt]]);export{Ot as default};
