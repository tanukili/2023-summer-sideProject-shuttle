import{_ as D,m as v,k as f,l as y,e as s,f as n,s as u,j as t,u as _,i as h,F as b,q as x,A as w,D as $,x as d,t as l,z as r,C,g as k,B as T}from"./index-17ffa8d7.js";import{u as B}from"./useActivitiesStore-2a2c90f7.js";import{u as N}from"./useCouponStore-aa319f29.js";import{B as j}from"./BackgroundBanner-8ee2f5ca.js";const q="/2023-summer-sideProject-shuttle",V="https://sideproject-shuttle.onrender.com",S={components:{BackgroundBanner:j},data(){return{bannerImg:`background-image: url(${q}/banner/banner-carts.jpg)`,couponCode:"",couponDiscount:0}},methods:{...v(B,["getActivities"]),...v(C,["getCart","putCart","deleteAllCart","deleteCart","goToOrder"]),useCoupon(o){this.axios.get(`${V}/coupons/${o}`).then(i=>{const g=i.data;console.log(i.data),this.$swal({icon:"success",confirmButtonText:"確認",title:`成功套用「${i.data.title}」`,showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutDown"}}),this.couponDiscount=i.data.discount,document.cookie=`couponDiscount=${this.couponDiscount}; max-age=86400;Secure`,g.is_used=!0}).catch(()=>{this.$swal({icon:"error",title:"優惠券使用失敗"})})},goToOrder(){this.$swal({title:`${this.allActive.title}`,html:`<p class='text-gray-400'>${this.allActive.description}</p>
            <p>目前金額再 <span class='text-danger'>NT$ ${this.countDifference} </span>可折抵 NT$ ${this.allActive.percentOff} </p>`,showDenyButton:!0,showCloseButton:!0,confirmButtonText:"修改訂單",denyButtonText:"下一步",denyButtonColor:"var(--bs-primary)"}).then(o=>{o.isDenied&&this.$router.push("/order")})}},mounted(){},created(){this.getActivities(),this.getCart()},computed:{...f(B,["allActive","unlimitedActivities","numActivities","nowAllDiscount"]),...f(C,["carts","totalBill","nowAllDiscount"]),...f(N,["cookieCouponDiscount"]),countDifference(){const o=this.allActive.requiredPrice;return o-this.totalBill%o},countFinal(){return this.couponDiscount?this.totalBill-this.couponDiscount-this.nowAllDiscount:this.totalBill-this.nowAllDiscount},imgBase(){return"/2023-summer-sideProject-shuttle"}}},I={class:"bg-white"},O={class:"block-spacing-sm container"},P={"aria-label":"breadcrumb",class:"mb-3"},F={class:"breadcrumb"},U={class:"breadcrumb-item"},z={class:"breadcrumb-item"},L=t("li",{class:"breadcrumb-item active","aria-current":"page"},"購物車",-1),M={key:0,class:"d-flex flex-column align-items-center"},R=t("span",{class:"material-symbols-outlined text-gray-200 p-4 rounded-circle my-4",style:{"font-size":"96px",border:"6px solid var(--bs-gray-100)"}}," production_quantity_limits ",-1),E=t("h2",null,"目前購物車沒有東西",-1),G={key:1},H=t("div",{class:"w-100 w-md-75 d-flex flex-column mx-auto my-5"},[t("ol",{class:"d-flex justify-content-around ps-0 fs-6 fw-bold"},[t("li",null,"訂單確認"),t("li",null,"填寫資料"),t("li",null,"訂單完成")]),t("div",{class:"progress border-dashed border-secondary"},[t("div",{class:"progress-bar",role:"progressbar",style:{width:"33.33%"},"aria-valuenow":"33.33","aria-valuemin":"0","aria-valuemax":"100"})])],-1),J={class:"d-flex align-items-center mb-2"},K=t("span",{class:"material-symbols-outlined icon-semibold"}," undo ",-1),Q={class:"table-responsive-sm"},W={class:"table align-middle table-white text-center fs-8 fs-lg-7"},X=t("thead",null,[t("tr",{class:"table-light bg-light"},[t("th",{scope:"col"}),t("th",{scope:"col"},[t("div",{class:"d-none d-md-flex flex-column"},"預覽")]),t("th",{scope:"col"},"課程名稱"),t("th",{scope:"col"},"價格"),t("th",{scope:"col"},"人數"),t("th",{scope:"col"},"小計"),t("th",{scope:"col"},[t("div",{class:"d-none d-md-flex flex-column px-md-3"}," 適用優惠 ")])])],-1),Y={scope:"row"},Z=["onClick"],tt=t("span",{class:"material-symbols-outlined icon-fill fs-5"}," delete_forever ",-1),et=[tt],ot={class:"d-none d-md-flex flex-column align-items-center"},st=["src","alt"],nt={class:"d-flex flex-column"},it={key:0,class:"text-gray-400 text-decoration-line-through"},lt={class:"select-icon"},at=["onUpdate:modelValue","onChange"],ct=["value"],dt={class:"d-flex flex-column"},rt={key:0,class:"text-gray-400 text-decoration-line-through"},ut={class:"fs-8 px-md-3"},pt={key:0,class:"d-none d-md-flex flex-column"},mt={key:0},_t={key:1},ht={key:0,class:"text-gray-200 fs-9 lh-lg fw-light"},ft={class:"row mb-4 pb-md-3 pt-2"},bt={class:"col-10 col-md-5"},gt={class:"input-group mb-3 mb-lg-4"},vt={class:"col-8 col-sm-6 col-md-5 col-lg-4 col-xl-3 ms-auto"},yt={class:"list-group rounded-2"},xt={class:"list-group-item border-0 text-mellow d-flex justify-content-between py-3"},wt=t("span",{class:"fw-bold"},"目前總金額",-1),Ct={key:0,class:"list-group-item border-0 d-flex justify-content-between"},kt=t("span",{class:"fw-bold"},"優惠券折抵",-1),Bt={class:"text-danger"},At={key:1,class:"list-group-item border-0 d-flex justify-content-between"},Dt=t("span",{class:"fw-bold"},"滿額折抵",-1),$t={class:"text-danger"},Tt={key:2,class:"list-group-item pb-3 border-0 d-flex justify-content-between"},Nt=t("span",{class:"fw-bold"},"折扣後金額",-1),jt={class:"d-flex"};function qt(o,i,g,Vt,a,p){const A=y("BackgroundBanner"),m=y("RouterLink");return s(),n(b,null,[u(A,{bannerImg:a.bannerImg,class:"cart-banner"},null,8,["bannerImg"]),t("div",I,[t("div",O,[t("nav",P,[t("ol",F,[t("li",U,[u(m,{to:"/"},{default:_(()=>[d("首頁")]),_:1})]),t("li",z,[u(m,{to:"/products"},{default:_(()=>[d("購買課程")]),_:1})]),L])]),o.carts.length?(s(),n("div",G,[H,t("div",J,[u(m,{class:"text-decoration-underline d-inline-block me-auto",to:"/products"},{default:_(()=>[K,d(" 返回課程列表 ")]),_:1}),t("a",{class:"btn btn-sm btn-outline-primary px-3 fw-normal d-inline-block shadow-none",href:"#",onClick:i[0]||(i[0]=h(e=>o.deleteAllCart(),["prevent"]))}," 清空購物車 ")]),t("div",Q,[t("table",W,[X,t("tbody",null,[(s(!0),n(b,null,x(o.carts,e=>(s(),n("tr",{key:e.id},[t("th",Y,[t("a",{href:"#",onClick:h(c=>o.deleteCart(e.id),["prevent"])},et,8,Z)]),t("td",null,[t("div",ot,[t("img",{src:`${p.imgBase}${e.product.imageUrl}`,alt:`product${e.id}`,class:"img-fluid",style:{"max-width":"150px"}},null,8,st)])]),t("td",null,l(e.product.title),1),t("td",null,[t("div",nt,[e.product.origin_price!==e.product.price?(s(),n("span",it,l(e.product.origin_price),1)):r("",!0),t("span",{class:k(`${e.product.origin_price!==e.product.price?"text-danger":!1}`)},l(e.product.price),3)])]),t("td",null,[t("div",lt,[w(t("select",{class:"form-select form-select-sm fs-lg-7 pe-4 border-secondary","onUpdate:modelValue":c=>e.qty=c,onChange:c=>o.putCart(e.id,parseInt(e.qty))},[(s(!0),n(b,null,x(e.product.info.capacity-e.product.info.studentNum,c=>(s(),n("option",{value:c,key:c},l(c),9,ct))),128))],40,at),[[T,e.qty]])])]),t("td",null,[t("div",dt,[e.final_total!==e.total?(s(),n("span",rt,l(e.total),1)):r("",!0),t("span",{class:k(`${e.final_total!==e.total?"text-danger":!1}`)},l(e.final_total),3)])]),t("td",ut,[e.product.state.promotion?(s(),n("div",pt,[o.unlimitedActivities[e.product.state.promotion]?(s(),n("div",mt,l(o.unlimitedActivities[e.product.state.promotion].title),1)):(s(),n("div",_t,[d(l(o.numActivities[e.product.state.promotion].title)+" ",1),e.qty<o.numActivities[e.product.state.promotion].requiredNum?(s(),n("div",ht,l(o.numActivities[e.product.state.promotion].description),1)):r("",!0)]))])):r("",!0)])]))),128))])])]),t("div",ft,[t("div",bt,[t("div",gt,[w(t("input",{"onUpdate:modelValue":i[1]||(i[1]=e=>a.couponCode=e),type:"text",class:"form-control fs-7",placeholder:"請輸入折扣碼","aria-label":"coupon number","aria-describedby":"coupon-btn"},null,512),[[$,a.couponCode]]),t("button",{class:"btn btn-secondary shadow-none py-2 fs-7",type:"button",id:"coupon-btn",onClick:i[2]||(i[2]=h(e=>p.useCoupon(a.couponCode),["prevent"]))}," 確認使用 ")])]),t("div",vt,[t("ul",yt,[t("li",xt,[wt,d("NT$ "+l(o.totalBill),1)]),a.couponDiscount?(s(),n("li",Ct,[kt,t("span",Bt,"NT$ - "+l(a.couponDiscount),1)])):r("",!0),o.allActive.requiredPrice<=o.totalBill?(s(),n("li",At,[Dt,t("span",$t,"NT$ - "+l(o.nowAllDiscount),1)])):r("",!0),a.couponDiscount||o.allActive.requiredPrice<=o.totalBill?(s(),n("li",Tt,[Nt,d("NT$ "+l(p.countFinal),1)])):r("",!0)])])]),t("div",jt,[t("button",{class:"btn btn-primary fs-7 fs-lg-6 fw-normal w-75 w-md-50 w-lg-25 mx-auto",onClick:i[3]||(i[3]=h(e=>p.goToOrder(),["prevent"]))}," 訂單確認 ")])])):(s(),n("div",M,[R,E,u(m,{to:"/products",class:"icon-e icon-east btn btn-primary-light mt-5",style:{width:"280px"}},{default:_(()=>[d(" 選購課程 ")]),_:1})]))])])],64)}const Ft=D(S,[["render",qt]]);export{Ft as default};
